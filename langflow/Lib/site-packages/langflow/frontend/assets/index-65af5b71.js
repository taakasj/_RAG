import{j as o,au as ee,av as R,aR as $,aS as ae,ax as u,u as P,h as U,aT as ne,aU as oe,az as se,aA as re,aV as te,r as C,aw as z,f as I,aW as O,I as L,aX as le,aD as de,aE as ce}from"./index-b79649fc.js";import{H as ie}from"./index-bd167df0.js";import{I as fe}from"./input-1cf994ba.js";const ue=({items:m,pathname:d})=>o.jsx("div",{className:"flex gap-2 overflow-auto lg:h-[70vh] lg:flex-col",children:m.map(r=>o.jsx(ee,{to:r.href,children:o.jsxs("div",{"data-testid":`sidebar-nav-${r.title}`,className:R($({variant:"ghost"}),d===r.href?"border border-border bg-muted hover:bg-muted":"border border-transparent hover:border-border hover:bg-transparent","flex w-full shrink-0 justify-start gap-4"),children:[r.icon,o.jsx("span",{className:"block max-w-full truncate opacity-100",children:r.title})]},r.title)}))}),pe=ue;function me(m){ae(m).then(d=>{const t=u.getState().folders.find(h=>h.id===m);d.folder_name=(t==null?void 0:t.name)||"folder",d.folder_description=(t==null?void 0:t.description)||"";const b=`data:text/json;chatset=utf-8,${encodeURIComponent(JSON.stringify(d))}`,l=document.createElement("a");l.href=b,l.download=`${d.folder_name}.json`,l.click()})}const he=(m,d)=>{const r=u(a=>a.setFolderDragging),t=u(a=>a.setFolderIdDragging),b=P(a=>a.setErrorData),l=u(a=>a.refreshFolders),h=U(a=>a.flows),c=a=>{d&&d(a)},j=async a=>{if(a.dataTransfer.types.some(s=>s==="Files")&&a.dataTransfer.files&&a.dataTransfer.files.length>0){const s=a.dataTransfer.files[0];s.type==="application/json"?E(s):b({title:se,list:[re]})}},f=(a,s)=>{a.preventDefault(),a.dataTransfer.types.some(g=>g==="Files")&&r(!0),t(s)},w=(a,s)=>{a.dataTransfer.types.some(g=>g==="Files")&&r(!0),t(s),a.preventDefault()},N=a=>{a.preventDefault(),a.target===a.currentTarget&&(r(!1),t(""))},v=(a,s)=>{var g,F;if((g=a==null?void 0:a.dataTransfer)!=null&&g.getData("flow")){const x=JSON.parse((F=a==null?void 0:a.dataTransfer)==null?void 0:F.getData("flow"));if(x){T(x.id,s);return}}a.preventDefault(),j(a)},T=(a,s)=>{const g=h.find(S=>S.id===a);if(!g)throw new Error("Flow not found");const F={...g,folder_id:s},x=ne(F,h);F.name=x,r(!1),t(""),oe(F).then(()=>{l(),c(s)})},E=a=>{const s=new FormData;s.append("file",a),r(!1),t(""),te(s).then(()=>{l(),c(m)})};return{dragOver:f,dragEnter:w,dragLeave:N,onDrop:v}},ge=({pathname:m,handleChangeFolder:d,handleDeleteFolder:r})=>{var _;const t=C.useRef(null),b=u(e=>e.setFolders),l=u(e=>e.folders),[h,c]=C.useState({}),j=U(e=>e.takeSnapshot),[f,w]=C.useState(l.map(e=>({name:e.name,edit:!1}))),N=u(e=>e.uploadFolder),v=m.split("/"),T=m.split("/").length<4,E=u(e=>e.myCollectionId),a=u(e=>e.folderIdDragging),s=u(e=>e.refreshFolders),g=e=>T&&e===E?!0:v.includes(e),F=z(),x=((_=F==null?void 0:F.state)==null?void 0:_.folderId)??E,S=u(e=>e.getFolderById),A=P(e=>e.setErrorData),V=P(e=>e.setSuccessData),W=e=>{S(e)},{dragOver:H,dragEnter:J,dragLeave:K,onDrop:M}=he(x,W),G=()=>{N(x).then(()=>{S(x),V({title:"Uploaded successfully"})}).catch(e=>{console.log(e),A({title:"Error on upload",list:[e.response.data]})})},X=e=>{me(e)};function q(){ce({name:"New Folder",parent_id:null,description:""}).then(e=>{s()})}function Q(e,B){const{target:{value:y}}=e;c(n=>({...n,[B]:y}))}return C.useEffect(()=>{l.map(e=>({name:e.name,edit:!1}))},[l]),o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex shrink-0 items-center justify-between gap-2",children:[o.jsx("div",{className:"flex-1 self-start text-lg font-semibold",children:"Folders"}),o.jsx(I,{variant:"primary",size:"icon",className:"px-2",onClick:q,"data-testid":"add-folder-button",children:o.jsx(O,{name:"FolderPlus",className:"w-4"})}),o.jsx(I,{variant:"primary",size:"icon",className:"px-2",onClick:G,"data-testid":"upload-folder-button",children:o.jsx(O,{name:"Upload",className:"w-4"})})]}),o.jsx("div",{className:"flex gap-2 overflow-auto lg:h-[70vh] lg:flex-col",children:o.jsx(o.Fragment,{children:l.map((e,B)=>{const y=f==null?void 0:f.filter(n=>n.name===e.name)[0];return o.jsx("div",{onDragOver:n=>H(n,e.id),onDragEnter:n=>J(n,e.id),onDragLeave:K,onDrop:n=>M(n,e.id),"data-testid":`sidebar-nav-${e.name}`,className:R($({variant:"ghost"}),g(e.id)?"border border-border bg-muted hover:bg-muted":"border hover:bg-transparent lg:border-transparent lg:hover:border-border","group flex w-full shrink-0 cursor-pointer gap-2 opacity-100 lg:min-w-full",a===e.id?"bg-border":""),onClick:()=>d(e.id),children:o.jsxs("div",{onDoubleClick:n=>{var D;if(e.name!=="My Projects"){if(h[e.name]||c({[e.name]:e.name}),(D=f.find(p=>p.name===e.name))!=null&&D.name){const p=f.map(i=>i.name===e.name?{name:e.name,edit:!0}:{name:i.name,edit:!1});w(p),j(),n.stopPropagation(),n.preventDefault();return}w(p=>[...p,{name:e.name,edit:!0}]),c(p=>({...p,[e.name]:e.name})),j(),n.stopPropagation(),n.preventDefault()}},className:"flex w-full items-center gap-4",children:[o.jsx(L,{name:"folder",className:"w-4 flex-shrink-0 justify-start stroke-[1.5] opacity-100"}),y!=null&&y.edit?o.jsx("div",{children:o.jsx(fe,{className:"w-36",onChange:n=>{Q(n,e.name)},ref:t,onKeyDown:n=>{var D;if(n.key==="Escape"){const p=f.map(i=>i.name===e.name?{name:e.name,edit:!1}:{name:i.name,edit:!1});w(p),c({}),w(l.map(i=>({name:i.name,edit:!1})))}n.key==="Enter"&&((D=t.current)==null||D.blur()),le(n,n.key,"")},autoFocus:!0,onBlur:async()=>{var D,p;const n=f.map(i=>i.name===e.name?{name:e.name,edit:!1}:{name:i.name,edit:!1});if(w(n),h[e.name].trim()!==""){c(k=>({...k,[e.name]:h[e.name]}));const i={...e,name:h[e.name],flows:((D=e.flows)==null?void 0:D.length)>0?e.flows:[],components:((p=e.components)==null?void 0:p.length)>0?e.components:[]},Y=await de(i,e.id),Z=l.filter(k=>k.name!==e.name);b([...Z,Y]),c({}),w(l.map(k=>({name:k.name,edit:!1})))}else c(i=>({...i,[e.name]:e.name}))},value:h[e.name],id:`input-folder-${e.name}`,"data-testid":"input-folder"})}):o.jsx("span",{className:"block w-full truncate opacity-100",children:e.name}),B>0&&o.jsx(I,{className:"hidden p-0 hover:bg-white group-hover:block hover:dark:bg-[#0c101a00]",onClick:n=>{r(e),n.stopPropagation(),n.preventDefault()},variant:"ghost",children:o.jsx(L,{name:"trash",className:"w-4 stroke-[1.5]"})}),o.jsx(I,{className:"hidden p-0 hover:bg-white group-hover:block hover:dark:bg-[#0c101a00]",onClick:n=>{X(e.id),n.stopPropagation(),n.preventDefault()},size:"none",variant:"none",children:o.jsx(L,{name:"Download",className:"w-4 stroke-[1.5] text-white"})})]})},e.id)})})})]})},Fe=ge;function De({className:m,items:d,handleChangeFolder:r,handleEditFolder:t,handleDeleteFolder:b,...l}){const c=z().pathname,j=u(v=>v.isLoadingFolders),f=u(v=>v.folders),N=["folder","components","flows","all"].some(v=>c.includes(v));return o.jsx("nav",{className:R(m),...l,children:o.jsx(ie,{children:d.length>0?o.jsx(pe,{items:d,pathname:c}):!j&&(f==null?void 0:f.length)>0&&N&&o.jsx(Fe,{pathname:c,handleChangeFolder:r,handleDeleteFolder:b})})})}export{De as S};
