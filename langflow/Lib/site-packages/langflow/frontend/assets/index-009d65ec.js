import{aY as Z,aZ as J,a_ as Q,a$ as L,b0 as F,p as X,r as h,A as b,b1 as ee,b2 as se,b3 as ae,j as e,I as te,$ as E,aK as v,b4 as N,aN as _,aM as R,aL as $,a as S,d as C,b5 as I,g as K,f as w,b6 as O,b7 as j,ai as re,b8 as ne,av as le,b9 as T,ba as oe,bb as ce,bc as ie,bd as de,be as ue,bf as he,bg as me,h as fe,at as xe,bh as pe,u as k,ae as f}from"./index-b79649fc.js";import{c as Pe}from"./cloneDeep-fdd5c7c9.js";import{I as A}from"./index-7fdcb736.js";import"./input-1cf994ba.js";import"./popover-13439e02.js";const ge=(t,o,a)=>({handlePatchPassword:async(s,l,n)=>{var d,r;if(s!==l){a({title:Z,list:[J]});return}try{s!==""&&await Q(t.id,{password:s}),n({target:{name:"password",value:""}}),n({target:{name:"cnfPassword",value:""}}),o({title:L})}catch(u){a({title:F,list:[(r=(d=u==null?void 0:u.response)==null?void 0:d.data)==null?void 0:r.detail]})}}}),je=ge,we=(t,o,a,c)=>({currentUserData:a,handlePatchProfilePicture:async l=>{var n,d;try{if(l!==""){await X(a.id,{profile_image:l});let r=Pe(a);r.profile_image=l,c(r)}t({title:L})}catch(r){o({title:F,list:[(d=(n=r==null?void 0:r.response)==null?void 0:n.data)==null?void 0:d.detail]})}}}),ye=we,be=(t,o,a,c,s)=>{const{storeApiKey:l}=h.useContext(b);return{handleSaveKey:(d,r)=>{d&&(s(!0),ee(d).then(()=>{t({title:se}),l(d),a(!0),c(!0),s(!1),r({target:{name:"apikey",value:""}})},u=>{o({title:ae,list:[u.response.data.detail]}),a(!1),c(!1),s(!1)}))}}},Se=be,Ce=(t,o)=>{h.useEffect(()=>{const a=document.getElementById(t??"null");a&&a.scrollIntoView({behavior:"smooth"})},[t]),h.useEffect(()=>{o("")},[o])},Ae=Ce,Ee=()=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex w-full items-center justify-between gap-4 space-y-0.5",children:e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsxs("h2",{className:"flex items-center text-lg font-semibold tracking-tight",children:["General",e.jsx(te,{name:"SlidersHorizontal",className:"ml-2 h-5 w-5 text-primary"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage settings related to Langflow and your account."})]})})}),ve=Ee,Ne=({password:t,cnfPassword:o,handleInput:a,handlePatchPassword:c})=>e.jsx(e.Fragment,{children:e.jsx(E,{onSubmit:s=>{c(t,o,a),s.preventDefault()},children:e.jsxs(v,{"x-chunk":"dashboard-04-chunk-2",children:[e.jsxs(N,{children:[e.jsx(_,{children:"Password"}),e.jsx(R,{children:"Type your new password and confirm it."})]}),e.jsx($,{children:e.jsxs("div",{className:"flex w-full gap-4",children:[e.jsxs(S,{name:"password",className:"w-full",children:[e.jsx(A,{id:"pasword",onChange:s=>{a({target:{name:"password",value:s}})},value:t,isForm:!0,password:!0,placeholder:"Password",className:"w-full"}),e.jsx(C,{match:"valueMissing",className:"field-invalid",children:"Please enter your password"})]}),e.jsxs(S,{name:"cnfPassword",className:"w-full",children:[e.jsx(A,{id:"cnfPassword",onChange:s=>{a({target:{name:"cnfPassword",value:s}})},value:o,isForm:!0,password:!0,placeholder:"Confirm Password",className:"w-full"}),e.jsx(C,{className:"field-invalid",match:"valueMissing",children:"Please confirm your password"})]})]})}),e.jsx(I,{className:"border-t px-6 py-4",children:e.jsx(K,{asChild:!0,children:e.jsx(w,{type:"submit",children:"Save"})})})]})})}),_e=Ne,Re=(t,o)=>{const a=async c=>Promise.all(c.map(s=>new Promise(l=>{const n=new Image;n.src=s,n.onload=l,n.onerror=l})));h.useEffect(()=>{const c=[],s=`${j.slice(0,j.length-1)}`;Object.keys(t).flatMap(l=>t[l].map(n=>c.push(`${s}${O}files/profile_pictures/${l}/${n}`))),a(c).then(()=>{o(!0)})},[t])};function $e({profilePictures:t,loading:o,value:a,onChange:c}){const s=h.useRef(null),l=re(r=>r.dark),[n,d]=h.useState(!1);return h.useEffect(()=>{var r;a&&s&&((r=s.current)==null||r.scrollIntoView({behavior:"smooth",block:"center"}))},[s,a]),Re(t,d),e.jsx("div",{className:"flex flex-col justify-center gap-2",children:o||!n?e.jsx(ne,{}):Object.keys(t).map((r,u)=>e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"edit-flow-arrangement",children:e.jsx("span",{className:"font-normal",children:r})}),e.jsx("div",{className:"block overflow-hidden",children:e.jsx("div",{className:"flex items-center gap-1 overflow-x-auto rounded-lg bg-muted px-1 custom-scroll",children:t[r].map((m,p)=>e.jsx(w,{ref:a===r+"/"+m?s:void 0,size:"none",variant:"none",onClick:()=>c(r+"/"+m),className:"shrink-0 px-0.5 py-2",children:e.jsx("img",{src:`${j.slice(0,j.length-1)}${O}files/profile_pictures/${r+"/"+m}`,style:{filter:a===r+"/"+m?l?"drop-shadow(0 0 0.3rem rgb(255, 255, 255))":"drop-shadow(0 0 0.3rem rgb(0, 0, 0))":""},className:le("h-12 w-12")},p)}))})})]}))})}const Ie=({profilePicture:t,handleInput:o,handlePatchProfilePicture:a,handleGetProfilePictures:c,userData:s})=>{const[l,n]=h.useState({}),[d,r]=h.useState(!0);return h.useEffect(()=>{const u=new AbortController;return c().then(m=>{m&&m.forEach(p=>{const[P,g]=p.split("/");n(x=>(x[P]?x[P].push(g):x[P]=[g],r(!1),x))})}).catch(()=>{r(!1)}),()=>u.abort()},[]),e.jsx(E,{onSubmit:u=>{a(t),u.preventDefault()},children:e.jsxs(v,{"x-chunk":"dashboard-04-chunk-1",children:[e.jsxs(N,{children:[e.jsx(_,{children:"Profile Picture"}),e.jsx(R,{children:"Choose the image that appears as your profile picture."})]}),e.jsx($,{children:e.jsx("div",{className:"py-2",children:e.jsx($e,{profilePictures:l,loading:d,value:t==""?(s==null?void 0:s.profile_image)??T[parseInt((s==null?void 0:s.id)??"",30)%T.length]:t,onChange:u=>{o({target:{name:"profilePicture",value:u}})}})})}),e.jsx(I,{className:"border-t px-6 py-4",children:e.jsx(K,{asChild:!0,children:e.jsx(w,{type:"submit",children:"Save"})})})]})})},Ke=Ie,Te=t=>({handleGetProfilePictures:async()=>{var a,c;try{return(await oe()).files}catch(s){ce.isCancel(s)?console.warn("Request canceled: ",s.message):t({title:ie,list:[(c=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:c.detail]})}}}),ke=Te,Le=({apikey:t,handleInput:o,handleSaveKey:a,loadingApiKey:c,validApiKey:s,hasApiKey:l})=>e.jsx(e.Fragment,{children:e.jsx(E,{onSubmit:n=>{n.preventDefault(),a(t,o)},children:e.jsxs(v,{"x-chunk":"dashboard-04-chunk-2",id:"api",children:[e.jsxs(N,{children:[e.jsx(_,{children:"Store API Key"}),e.jsx(R,{children:(l&&!s?de:l?"":ue)+he})]}),e.jsx($,{children:e.jsxs("div",{className:"flex w-full flex-col gap-3",children:[e.jsx("div",{className:"flex w-full gap-4",children:e.jsxs(S,{name:"apikey",className:"w-full",children:[e.jsx(A,{id:"apikey",onChange:n=>{o({target:{name:"apikey",value:n}})},value:t,isForm:!0,password:!0,placeholder:"Insert your API Key",className:"w-full"}),e.jsx(C,{match:"valueMissing",className:"field-invalid",children:"Please enter your API Key"})]})}),e.jsxs("span",{className:"pr-1 text-xs text-muted-foreground",children:[me," ",e.jsx("a",{className:"text-high-indigo underline",href:"https://langflow.store/",target:"_blank",children:"langflow.store"})]})]})}),e.jsx(I,{className:"border-t px-6 py-4",children:e.jsx(K,{asChild:!0,children:e.jsx(w,{loading:c,type:"submit","data-testid":"api-key-save-button-store",children:"Save"})})})]})})}),Fe=Le;function He(){const t=fe(i=>i.setCurrentFlowId),{scrollId:o}=xe(),[a,c]=h.useState(pe),{autoLogin:s}=h.useContext(b),l=k(i=>i.setSuccessData),n=k(i=>i.setErrorData),{userData:d,setUserData:r}=h.useContext(b),u=f(i=>i.hasStore),m=f(i=>i.validApiKey),p=f(i=>i.hasApiKey),P=f(i=>i.updateHasApiKey),g=f(i=>i.loadingApiKey),x=f(i=>i.updateValidApiKey),G=f(i=>i.updateLoadingApiKey),{password:U,cnfPassword:D,profilePicture:M,apikey:H}=a,{handlePatchPassword:V}=je(d,l,n),{handleGetProfilePictures:Y}=ke(n),{handlePatchProfilePicture:B}=ye(l,n,d,r);Ae(o,t);const{handleSaveKey:z}=Se(l,n,P,x,G);function y({target:{name:i,value:W}}){c(q=>({...q,[i]:W}))}return e.jsxs("div",{className:"flex h-full w-full flex-col gap-6",children:[e.jsx(ve,{}),e.jsxs("div",{className:"grid gap-6",children:[e.jsx(Ke,{profilePicture:M,handleInput:y,handlePatchProfilePicture:B,handleGetProfilePictures:Y,userData:d}),!s&&e.jsx(_e,{password:U,cnfPassword:D,handleInput:y,handlePatchPassword:V}),u&&e.jsx(Fe,{apikey:H,handleInput:y,handleSaveKey:z,loadingApiKey:g,validApiKey:m,hasApiKey:p})]})]})}export{He as default};
